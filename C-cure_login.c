#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>
#include <string.h>

void admin_function(long cmd, char * message){
  printf("\nWelcome Admin!\n");
  printf("\nMore command actions will be available soon, but for now...\nDisplaying current processes:\n");
  fflush(stdout);
  system("ps");
}

void user_function(long command, char * new_motto){
  printf("\nWelcome User!\n");

  if (command==1){
    char user_motto[64];
    FILE *fp;
    fp = fopen("user_motto", "r");
    fscanf(fp, "%[^\n]", user_motto);
    fclose(fp);

    printf("\nThe user motto is :\t%s\n", user_motto);
  }
  else{
    FILE *fp;
    fp = fopen("user_motto", "w");
    int i;
    for(i=0;i<sizeof(new_motto);i++){
      putc((char)new_motto[i], fp);
    }
    fclose(fp);

    printf("\nUser's new Motto set to :\t");
    printf(new_motto);
  }
  fflush(stdout);
  return;
}

int main(int argc, char * argv[])
{
  char userpass[16];
  char password[16];
  char adminpass[16];
  char username[16];
  char message[64];

  FILE *fp1;
  fp1 = fopen("user_password", "r");
  fscanf(fp1, "%s", userpass);
  fclose(fp1);

  strcpy(username,argv[1]);
  strcpy(password,argv[2]);
  long int command = strtol(argv[3], NULL, 0);
  strcpy(message,argv[4]);

  int user_name_allowed = 0;
  if (!strcmp(username,"user")){
    user_name_allowed = 1;
    if(!memcmp(password, userpass, sizeof(userpass))){
      user_function(command, message);
    }
    else{
      printf("\nIncorrect Password\n");
      exit(0);
    }
  }
  else if(!strcmp(username,"admin")){
    FILE *fp2;
    fp2 = fopen("admin_password", "r");
    fscanf(fp2, "%s", adminpass);
    fclose(fp2);
    user_name_allowed = 1;
    if(!memcmp(password, adminpass, sizeof(adminpass))){
      admin_function(command, message);
    }else{
      printf("\n\nIncorrect Password\n");
      exit(0);
    }
  }

  if(!user_name_allowed){
    printf("\n\nIncorrect Username\n");
  }
	return 0;
}
